CSE508: Network Security, Spring 2024
Homework 1: Passive Network Monitoring
Student Name: Santa Maria Shithil
SBU ID: 115074486
-------------------------------------------------------------------------------

1. Network traffic analysis with tcpdump

 1.1 How many packets does the trace contain?
     Answer: 32616
     Command used: tcpdump -n -r hw1.pcap | wc -l
 
 1.2 How many ARP packets and how many UDP packets?
     Part1: How many ARP packets?
          Answer: 11304
          Command Used: tcpdump -n -r hw1.pcap arp|wc -l
     Part2: How many UDP packets?
          Answer: 18334
          Command Used: tcpdump -n -r hw1.pcap udp| wc -l

 1.3 How many DHCP packets?
     Answer: 256
     Command Used: tcpdump -r hw1.pcap -n 'udp and (port 67 or port 68)' | wc -l
 
 1.4 How many packets were exchanged between 91.189.90.41 and 192.168.0.200?
     Answer: 14
     Command Used1: tcpdump -n -r hw1.pcap "(ip src 91.189.90.41 or ip src 192.168.0.200) and (ip dst 192.168.0.200 or ip dst 91.189.90.41)" | wc -l
     Command Used2: tcpdump -n "(ip src 192.168.0.200 and ip dst 91.189.90.41) or (ip src 91.189.90.41 and ip dst 192.168.0.200)" -r hw1.pcap | wc -l
 
 1.5 Print the unique source IP addresses found in the trace in numerical
     order.
     Answer: 
     0.0.0.0
     1.234.31.20
     46.51.197.88
     46.51.197.89
     62.252.170.81
     62.252.170.91
     87.98.246.8
     87.230.23.162
     91.189.88.33
     91.189.89.88
     91.189.90.40
     91.189.90.41
     91.189.91.14
     91.189.91.15
     91.189.92.190
     92.240.68.152
     122.154.101.54
     130.75.16.5
     159.148.96.184
     169.254.56.55
     192.168.0.1
     192.168.0.2
     192.168.0.3
     192.168.0.5
     192.168.0.6
     192.168.0.7
     192.168.0.10
     192.168.0.11
     192.168.0.12
     192.168.0.200
     194.168.4.100
     216.137.63.121
     216.137.63.137
     Command Used: tcpdump -r hw1.pcap -n ip| awk '{print $3}' | cut -d '.' -f 1-4 | sort -t '.' -k 1,1n -k 2,2n -k 3,3n -k 4,4n | uniq

 1.6 Print the unique 'private network' (according to RFC1918) source IP
     addresses found in the trace in numerical order.
     Answer:
     192.168.0.1
     192.168.0.2
     192.168.0.3
     192.168.0.5
     192.168.0.6
     192.168.0.7
     192.168.0.10
     192.168.0.11
     192.168.0.12
     192.168.0.200
     Command Used: tcpdump -r hw1.pcap -nn ip| awk '{print $3}' | cut -d '.' -f 1-4 | sort -t '.' -k 1,1n -k 2,2n -k 3,3n -k 4,4n | uniq| grep -E '^(10\.|172\.(1[6-9]|2[0-9]|3[0-1])\.|192\.168\.)'
 
 1.7 Print the unique destination IP addresses found in the trace in numerical
     order.
     Answer:
     1.234.31.20
     46.51.197.88
     46.51.197.89
     62.252.170.81
     62.252.170.91
     87.98.246.8
     87.230.23.162
     91.189.88.33
     91.189.89.88
     91.189.90.40
     91.189.90.41
     91.189.91.14
     91.189.91.15
     91.189.92.190
     92.240.68.152
     122.154.101.54
     130.75.16.5
     159.148.96.184
     169.254.255.255
     192.168.0.12
     192.168.0.200
     192.168.0.255
     194.168.4.100
     216.137.63.121
     216.137.63.137
     224.0.0.22
     224.0.0.251
     224.0.0.252
     239.255.255.250
     255.255.255.255
     Command Used: tcpdump -r hw1.pcap -n ip | awk '{print $5}' | cut -d ':' -f 1 | cut -d '.' -f 1-4| sort -t '.' -k 1,1n -k 2,2n -k 3,3n -k 4,4n | uniq
     

 1.8 What are the top-5 TCP and top-5 UDP destination ports?
     Part1: What are the top-5 TCP ports?
          Answer: 
          727 80
          697 54634
          346 49836
          61 47110
          36 40341
          Here first column represents the frequency and the second column represents the ports. So, top 5 tcp ports are 80, 54634, 49836, 47110, 
          and 40342. 
          Command Used: tcpdump -n -r hw1.pcap tcp  | awk '{print $5}' | cut -d '.' -f 5| cut -d ':' -f 1|sort| uniq -c|sort -nr| head -5

     Part2: What are the top-5 UDP destination ports?
          Answer:
          13178 1900
          1925 137
          1516 5355
          840 5353
          399 138
          Similarly, first column represents the frequency and the second column represents the ports. So, top 5 tcp ports are 1900, 137, 5355, 5353, 
          and 138.
          Command Used: tcpdump -n -r hw1.pcap udp| awk '{print $5}' | cut -d '.' -f 5| cut -d ':' -f 1|sort| uniq -c|sort -nr| head -5
 
 1.9 How many TCP packets have the SYN flag set?
     Answer: 75
     Command Used1: tcpdump -n -r hw1.pcap 'tcp[tcpflags] & tcp-syn != 0' | wc -l
     Command Used2: tcpdump -n -r hw1.pcap '(tcp[13] & 2) == 2' | wc -l

1.10 How many TCP connection attempts were made?
     Answer: 37
     Command Used1: tcpdump -n -r hw1.pcap 'tcp[13] == 2' | wc -l 
     Command Used2:  tcpdump -n -r hw1.pcap 'tcp[tcpflags] == tcp-syn' | wc -l
 
1.11 Towards which ports were TCP connection attempts made? How many attempts
     per port?
     Part1: Towards which ports were TCP connection attempts made?
          Answer:
          443
          465
          80
          9100
          Command Used: tcpdump -n -r hw1.pcap 'tcp[13] == 2'| awk '{print $5}' | cut -d '.' -f 5|cut -d ':' -f 1| sort| uniq 

     Part2: How many attempts per port?
          Answer: 
          1 443
          1 465
          33 80
          2 9100
          Here first column represents the number of attempts and the second column represents the 
          port number. 
          Command: tcpdump -n -r hw1.pcap 'tcp[13] == 2'| awk '{print $5}' | cut -d '.' -f 5|cut -d ':' -f 1| sort| uniq -c
 
1.12 How many HTTP GET requests were made? Print the URLs of all HTTP requests
     for JPG files.
     Part1: How many HTTP GET requests were made?
     Answer: 94
     Command Used: tcpdump -n '(tcp port http) && (tcp[32:4] = 0x47455420)' -r hw1.pcap | wc -l

     Part2: Print the URLs of all HTTP requests for JPG files.
     Answer:
     http://pic.leech.it/i/f166c/479246b0asttas.jpg
     /i/f166c/479246b0asttas.jpg
     http://ecx.images-amazon.com/images/I/41oZ1XsiOAL._SL500_AA300_.jpg
     http://www.nature.com/news/2009/090527/images/459492a-i1.0.jpg
     /news/2009/090527/images/459492a-i1.0.jpg
     Command Used: tcpdump -n '(tcp port http) && (tcp[32:4] = 0x47455420)' -r hw1.pcap| grep GET| rev| cut -d ' ' -f 2| rev| grep jpg| uniq

1.13 When (date and time) was the first and last packet of the trace sent?
     Part1:When (date and time) was the first packet of the trace sent?
     Answer: 2013-01-12 11:37:42.871346
     Command Used: tcpdump -r hw1.pcap -nn -tttt -c 1 | head -n 1| cut -d ' ' -f 1-2

     Part2: When (date and time) was the last packet of the trace sent?
     Answer: 2013-01-14 13:27:03.691498
     Command Used: tcpdump -r hw1.pcap -nn -tttt| tail -n 1| cut -d ' ' -f 1-2

1.14 What is the brand of the device that sent most of the packets? What is its
     IP address?
     Part1: What is the brand of the device that sent most of the packets?
     
     Answer: 'Netgear'

     Solution Approach: First I find the MAC address of the device that sent most of the packets
     using the following command:
     tcpdump -r hw1.pcap -e -nn| awk '{print $2}'| sort | uniq -c| sort -rn| head -n 1| awk '{print $2}'
     The MAC address of the device is : c4:3d:c7:17:6f:9b
     Then I used the https://macaddress.io/ webiste to find the brand of the device. 
     I lookup with the OUI c4:3d:c7 (OUI is the first 3 octet of the MAC address c4:3d:c7:17:6f:9b 
     that represents the organizational unique identifier)
     The website shows that the brand name is 'Netgear'.
     
     Therefore, the brand name of the device that sent most of the packets is 'Netgear'. 

     Part2: What is its IP address?
     Answer: 192.168.0.1
     Solution Approach: To find the IP address, first I picked the first record from the 
     trace that has the source MAC address c4:3d:c7:17:6f:9b using the following command
     
     tcpdump -n ether src c4:3d:c7:17:6f:9b -r hw1.pcap -c 1

     The output of the command is: 
     11:37:42.871346 ARP, Request who-has 192.168.0.12 tell 192.168.0.1, length 46
     
     We can see, it's an ARP packet. So the IP address after the word "tell" is the IP address
     of the source. Becasue the line says that the source machine who has IP address 
     192.168.0.1 sent an ARP packet asking for the MAC address of the machine who has IP 
     address 192.168.0.12. Then I run the following command to get the source IP address
     
     tcpdump -n ether src c4:3d:c7:17:6f:9b -r hw1.pcap -c 1 | awk '{print$7}'| cut -d ',' -f 1

     And the output of this command is : 192.168.0.1

1.15 Report the distribution of Ethernet packet sizes (how many packets of size
     X exist in the trace, for all values of X in the trace), numerically
     sorted by packet size.

     Solution Approach1: 
     Answer: First column represents the number of occurances and the second column 
     represents the corresponding packet size.
     24 42
     1 54
     12190 60
     13 62
     232 63
     887 64
     4 65
     1046 66
     8 68
     6 69
     3 70
     1 72
     87 74
     8 75
     6 76
     2 77
     4 79
     54 81
     4 82
     43 84
     4 85
     14 87
     5 88
     4 89
     13 90
     341 91
     1740 92
     2 93
     2 94
     2 95
     2 105
     4 106
     10 107
     180 110
     2 111
     28 119
     121 120
     4 124
     7 125
     15 127
     2 129
     11 142
     1 144
     7 149
     10 154
     1 156
     60 165
     62 167
     12 168
     4 170
     1 171
     146 175
     4 177
     1 178
     2 184
     1 195
     17 202
     1 207
     2 208
     39 219
     2 220
     1 223
     2 229
     36 231
     3 233
     2 236
     279 243
     4 244
     16 245
     22 246
     3 247
     9 248
     56 249
     2 252
     4 254
     2 255
     2 257
     2 261
     6 264
     2 265
     2 266
     4 267
     2 268
     3 269
     6 282
     9 284
     2 288
     2 294
     3 298
     15 302
     2 305
     1 306
     12 307
     1 308
     2 309
     2 310
     1 312
     24 315
     1 317
     86 318
     1 320
     2 321
     4 322
     85 326
     7 328
     5 329
     10 330
     2773 331
     10 332
     6 333
     1 335
     88 338
     2749 340
     326 342
     3 344
     4 345
     4 346
     1 347
     6 350
     86 362
     1 372
     1 374
     2 383
     88 386
     1 389
     87 390
     87 392
     86 394
     2759 395
     1 396
     85 398
     2758 405
     1 412
     1 417
     2 418
     1 428
     1 429
     1 432
     1 433
     1 446
     33 460
     164 475
     10 476
     2 478
     1 479
     1 482
     165 484
     10 485
     13 489
     3 497
     2 502
     1 506
     1 518
     158 527
     10 528
     1 535
     162 539
     10 540
     155 541
     10 542
     1 544
     2 546
     1 548
     2 550
     17 551
     1 552
     161 555
     10 556
     1 568
     1 588
     2 590
     1 592
     2 593
     1 596
     2 598
     1 601
     32 602
     2 607
     1 608
     6 610
     2 611
     2 612
     5 613
     2 614
     2 615
     2 621
     2 624
     5 628
     2 630
     2 636
     1 640
     12 666
     1 678
     1 679
     1 690
     1 694
     22 698
     2 704
     1 730
     1 746
     1 752
     1 760
     8 816
     5 817
     1 926
     1 952
     1 979
     40 1033
     6 1034
     4 1035
     1 1102
     1 1162
     1 1170
     1 1179
     2 1212
     1 1218
     1 1469
     1034 1514
     Command Used: tcpdump -r hw1.pcap -nn -e | awk '{print $9}' | cut -d ':' -f 1 | sort -n| uniq -c


     Solution Approach2: 

2. What to submit

An plain ASCII text file with the answers to the above questions, along with
the command/script/approach used to find them.
